<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Marketing Performance Dashboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --navy:#003A70;
      --teal:#3ED6D3;
      --ink:#011627;
      --bg:#F5F7FA;
      --white:#FFFFFF;
    }
    body{margin:0;font-family:Poppins,sans-serif;background:var(--bg);color:var(--ink);}
    header{background:var(--navy);color:var(--white);padding:22px 20px;}
    .wrap{max-width:1100px;margin:0 auto;padding:18px;}
    .kpis{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:14px;margin-top:14px;}
    .card{background:var(--white);border-radius:16px;padding:14px 14px 16px;box-shadow:0 2px 10px rgba(0,0,0,.06);border-left:6px solid var(--teal);}
    .label{font-size:12px;opacity:.75;text-transform:uppercase;letter-spacing:.08em}
    .value{font-size:26px;font-weight:700;margin-top:6px}
    .sub{font-size:12px;opacity:.75;margin-top:6px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px;}
    .panel{background:var(--white);border-radius:16px;padding:14px;box-shadow:0 2px 10px rgba(0,0,0,.06);}
    .panel h3{margin:0 0 10px 0;font-size:14px}
    .muted{opacity:.8}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:10px}
    .pill{padding:6px 10px;border-radius:999px;background:rgba(62,214,211,.18);font-size:12px;font-weight:600}
    @media (max-width:980px){.kpis{grid-template-columns:1fr 1fr}.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div style="display:flex;justify-content:space-between;gap:10px;align-items:flex-end;flex-wrap:wrap">
        <div>
          <div style="font-weight:700;font-size:20px">Marketing Performance Dashboard</div>
          <div class="muted" id="period">Live from Google Sheets</div>
        </div>
        <div class="pill" id="lastUpdated">Loading…</div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="kpis">
      <div class="card"><div class="label">Meta Spend</div><div class="value" id="metaSpend">–</div></div>
      <div class="card"><div class="label">Meta Leads</div><div class="value" id="metaLeads">–</div></div>
      <div class="card"><div class="label">Google Spend</div><div class="value" id="googleSpend">–</div></div>
      <div class="card"><div class="label">Google Leads</div><div class="value" id="googleLeads">–</div></div>
    </section>

    <section class="kpis" style="grid-template-columns:repeat(3,minmax(0,1fr));margin-top:14px">
      <div class="card"><div class="label">Total Spend</div><div class="value" id="totalSpend">–</div></div>
      <div class="card"><div class="label">Total Leads</div><div class="value" id="totalLeads">–</div></div>
      <div class="card"><div class="label">Blended CPL</div><div class="value" id="blendedCpl">–</div></div>
    </section>

    <section class="grid">
      <div class="panel">
        <h3>Spend by Channel</h3>
        <canvas id="spendChart"></canvas>
      </div>
      <div class="panel">
        <h3>Leads by Channel</h3>
        <canvas id="leadsChart"></canvas>
      </div>
    </section>

    <section class="panel" style="margin-top:14px">
      <h3>Notes</h3>
      <div class="muted">Add a “Notes” field to your sheet later if you want this to pull through too.</div>
      <div class="row"><div class="muted">Tip:</div><div class="pill">Refresh page after updates</div></div>
    </section>
  </main>

  <script>
    const CSV_URL = "PASTE_YOUR_CSV_PUBLISHED_LINK_HERE";

    const money = (n) =>
      Number(n || 0).toLocaleString("en-GB", { style: "currency", currency: "GBP" });

    function parseCsvToMap(csvText) {
      const lines = csvText.trim().split(/\r?\n/);
      // expecting: metric,value
      const map = {};
      for (let i = 1; i < lines.length; i++) {
        const [metric, value] = lines[i].split(",");
        if (!metric) continue;
        map[metric.trim()] = (value ?? "").trim();
      }
      return map;
    }

    function num(x){
      // handle blanks; force number
      const v = String(x ?? "").replace(/£/g,"").replace(/,/g,"").trim();
      const n = Number(v);
      return Number.isFinite(n) ? n : 0;
    }

    let spendChart, leadsChart;

    function render(data){
      const metaSpend = num(data.meta_spend);
      const metaLeads = num(data.meta_leads);
      const googleSpend = num(data.google_spend);
      const googleLeads = num(data.google_leads);

      const totalSpend = metaSpend + googleSpend;
      const totalLeads = metaLeads + googleLeads;
      const blendedCpl = totalLeads === 0 ? 0 : totalSpend / totalLeads;

      document.getElementById("metaSpend").textContent = money(metaSpend);
      document.getElementById("metaLeads").textContent = metaLeads.toLocaleString("en-GB");
      document.getElementById("googleSpend").textContent = money(googleSpend);
      document.getElementById("googleLeads").textContent = googleLeads.toLocaleString("en-GB");

      document.getElementById("totalSpend").textContent = money(totalSpend);
      document.getElementById("totalLeads").textContent = totalLeads.toLocaleString("en-GB");
      document.getElementById("blendedCpl").textContent = totalLeads === 0 ? "–" : money(blendedCpl);

      document.getElementById("lastUpdated").textContent =
        "Updated: " + new Date().toLocaleString("en-GB");

      const spendData = [metaSpend, googleSpend];
      const leadsData = [metaLeads, googleLeads];

      if (spendChart) spendChart.destroy();
      if (leadsChart) leadsChart.destroy();

      spendChart = new Chart(document.getElementById("spendChart"), {
        type: "bar",
        data: { labels: ["Meta", "Google"], datasets: [{ label: "Spend", data: spendData }] },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });

      leadsChart = new Chart(document.getElementById("leadsChart"), {
        type: "bar",
        data: { labels: ["Meta", "Google"], datasets: [{ label: "Leads", data: leadsData }] },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });
    }

    async function load(){
      const res = await fetch(CSV_URL, { cache: "no-store" });
      if (!res.ok) throw new Error("Failed to load CSV");
      const csv = await res.text();
      const map = parseCsvToMap(csv);
      render(map);
    }

    load().catch(err => {
      document.getElementById("lastUpdated").textContent = "Error loading data";
      console.error(err);
    });
  </script>
</body>
</html>
